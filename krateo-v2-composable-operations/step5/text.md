# Exploring Generated RBAC Resources

When a composition is instantiated, the `composition-dynamic-controller`, in conjunction with the `chart-inspector`, templates the chart with the values from the composition and generates a list of resources involved in the chart installation.

It is important to note that the running `composition-dynamic-controller` may have multiple RBAC policies applied. One is created by the `core-provider` with a limited set of permissions needed to manage `composition` resources, and others are generated for each composition applied in the cluster. For example, if two compositions are applied, the `composition-dynamic-controller` service account will have three different RBAC policies: one from the `core-provider` and two from the compositions.

## Service Account (Common Across Policies and Initially Generated by Core-Provider)

First, let's examine the Service Account created for the controller:

```bash
# View the Service Account details
kubectl get serviceaccount githubscaffoldings-v1-0-0 -n ghscaffolding-system -o yaml | yq
```{{exec}}

This Service Account is used by the controller pod to interact with the Kubernetes API.

## Role-Based Access Control (RBAC) Resources

### 1. Roles
Roles define permissions within a specific namespace:

```bash
# View detailed role configuration
kubectl get role githubscaffoldings-v1-0-0 -n ghscaffolding-system -o yaml | yq
```{{exec}}

### 2. RoleBindings
RoleBindings link the Roles to the Service Account within the namespace:

```bash
# View detailed role binding configuration
kubectl get rolebinding githubscaffoldings-v1-0-0 -n ghscaffolding-system -o yaml | yq
```{{exec}}

### 3. ClusterRoles
ClusterRoles define permissions that apply across the entire cluster:

```bash
# View detailed cluster role configuration
kubectl get clusterrole githubscaffoldings-v1-0-0 -o yaml | yq
```{{exec}}

### 4. ClusterRoleBindings
ClusterRoleBindings link the ClusterRoles to the Service Account:

```bash
# View detailed cluster role binding configuration
kubectl get clusterrolebinding githubscaffoldings-v1-0-0 -o yaml | yq
```{{exec}}

These policies are created by the `core-provider` and contain a fixed set of permissions needed to manage `compositions`.

## `composition-dynamic-controller` Generated RBAC Resources

Now, let's examine the RBAC resources generated by the `composition-dynamic-controller` from a composition render.

Let's retrieve the resource names associated with the last created composition:

```bash
export COMPOSITION_NAME_2=$(kubectl get compositions -n ghscaffolding-system gh-scaffolding-composition-1 -o yaml | yq '.metadata.labels["krateo.io/release-name"]')

### 1. Roles
Roles define permissions within a specific namespace:

```bash
# View detailed role configuration
kubectl get role $COMPOSITION_NAME_2 -n ghscaffolding-system -o yaml | yq
```{{exec}}

### 2. RoleBindings
RoleBindings link the Roles to the Service Account within the namespace:

```bash
# View detailed role binding configuration
kubectl get rolebinding $COMPOSITION_NAME_2 -n ghscaffolding-system -o yaml | yq
```{{exec}}

### 3. ClusterRoles
ClusterRoles define permissions that apply across the entire cluster:

```bash
# View detailed cluster role configuration
kubectl get clusterrole $COMPOSITION_NAME_2 -o yaml | yq
```{{exec}}

### 4. ClusterRoleBindings
ClusterRoleBindings link the ClusterRoles to the Service Account:

```bash
# View detailed cluster role binding configuration
kubectl get clusterrolebinding $COMPOSITION_NAME_2 -o yaml | yq
```{{exec}}